!function(){"use strict";var e,t,i,a={565:function(e,t,i){function a(e,t){var i;if(void 0===t||!t.length)return!1;for(var a=t.split("&"),n=0;n<a.length;n++)if((i=a[n].split("="))[0]==e)return i[1];return!1}i.d(t,{c:function(){return a}})},567:function(e){e.exports=window.jQuery},821:function(e){e.exports=window.mpp}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return a[e](i,i.exports,o),i.exports}o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},o.d=function(e,t){for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e=o(567),t=o.n(e),i=o(565),o(821),function(e){const t=_.clone(_mppUploadSettings),a=_.clone(_mppUploaderFeedbackL10n),n=mpp.mediaUtils;function o(e){return"mpp-activity-uploader-"+e}function r(e){return _mppUploaders[e]?window._mppUploaders[e]:null}e(document).ready((function(){let c=e("#aw-whats-new-submit"),p=e("#mpp-activity-upload-buttons"),d=e("#whats-new-options"),s=n.getExtensions(t.current_type);p.length&&d.length&&d.prepend(p);let l=new mpp.Uploader("activity",{el:"#mpp-upload-dropzone-activity",url:t.url,l10n:a,params:_.extend({},t.params,{context:"activity"}),allowedFileTypes:n.prepareExtensions(s),addRemoveLinks:!0,events:{error:function(){c.prop("disabled",!1)},complete:function(){c.prop("disabled",!1)},allAdded:function(){c.prop("disabled",!0)}}});l.init(),e(document).on("click","#mpp-activity-upload-buttons a",(function(){return l.isAttached()&&(t.current_type=e(this).data("media-type"),n.setupUploaderFileTypes(l,t.current_type),l.refresh(),l.showUI(),t.activity_disable_auto_file_browser=parseInt(t.activity_disable_auto_file_browser,10),t.activity_disable_auto_file_browser||l.openFileChooser()),e(".mpp-remote-add-media-row-activity").show(),!1})),e(document).on("click",".mpp-activity-new-media-container .mpp-upload-container-close",(function(){return l.hideUI(),l.refresh(),!1})),e(document).ajaxSend((function(e,t,a){let n=null,c=null;switch((0,i.c)("action",a.data)){case"post_update":case"swa_post_update":c=l;break;case"new_activity_comment":c=r(o((0,i.c)("form_id",a.data)));break;case"activity_post_comment":c=r(o((0,i.c)("activity_id",a.data)))}c&&(n=c.getUploadedMediaIDs().join(","),n&&(a.data=a.data+"&mpp-attached-media="+n,c.reset()))})),e(document).ajaxComplete((function(t,a,n){switch((0,i.c)("action",n.data)){case"post_update":case"swa_post_update":e(".mpp-remote-add-media-row-activity").hide(),l.hideUI(),l.refresh();break;case"new_activity_comment":let t=r(o((0,i.c)("form_id",n.data)));t&&(t.hideUI(),t.refresh());break;case"activity_post_comment":let a=r(o((0,i.c)("activity_id",n.data)));a&&(a.hideUI(),a.refresh())}})),e(document).on("click",".mpp-activity-comment-upload-buttons a",(function(){let i=e(this),c=i.closest(".mpp-activity-comment-upload-buttons"),p=c.closest(".comment-item"),d=c.length?c.data("activity-id"):0,s=0,l=i.data("media-type");p.length&&(s=p.data("bp-activity-comment-id"));let u=o(d),m=r(u);return m&&(m.getParam("comment_id")!=s?(m.destroy(),m=null):m.type&&m.type!==l&&n.setupUploaderFileTypes(m,l)),m||(m=new mpp.Uploader(u,{el:"#mpp-upload-dropzone-activity-comment-"+d,url:t.url,l10n:a,params:_.extend({},t.params,{context:"activity-comment",activity_id:d}),allowedFileTypes:n.prepareExtensions(n.getExtensions(l)),addRemoveLinks:!0,help:{allowedFileType:t.allowed_type_messages[l],fileSize:t.max_allowed_file_size?t.max_allowed_file_size:"",browse:""},events:{error:function(){},complete:function(){},allAdded:function(){}}}),m.type=l,m.init()),m.setParam("comment_id",s),m.isAttached()&&(m.showUI(),t.activity_disable_auto_file_browser=parseInt(t.activity_disable_auto_file_browser,10),t.activity_disable_auto_file_browser||m.openFileChooser()),!1})),e(document).on("click",".mpp-activity-comment-new-media-container .mpp-upload-container-close",(function(){let t=e(this).data("activity-id");if(!t)return!1;let i=r(o(t));return i&&(i.hideUI(),i.refresh()),!1})),e(document).on("click",".acomment-reply",(function(){let t=r(o(e(this).closest(".activity-item").data("bp-activity-id")));t&&(t.hideUI(),t.destroy())}))}))}(t())}();
//# sourceMappingURL=mpp-activity-uploader.js.map