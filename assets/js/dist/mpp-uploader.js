!function(){"use strict";var e={965:function(e,t,i){i.d(t,{Z:function(){return p}});var s=i(711),n=i.n(s),a=i(567),r=i.n(a),o=i(623),l=i.n(o),d=i(934);window._mppUploaders=window._mppUploaders||{};class p{constructor(e,t){this.id=e,this.mediaType=t.mediType||"",this.allowedFileTypes=t.allowedFileTypes||null,this.params=t.params||{},this.$el=null,this.$container=null,this.$wrapper=null,this.$feedback=null,this.isResetting=!1,this.settings=n().extend({},{paramName:"_mpp_file",showFeedback:!0},t),this._events=t.events&&n().isObject(t.events)?t.events:{},this._eventRegistry=new d.Z,this._dropzone=null,this._isEnabled=!!t.isEnabled,this._initialized=!1,window._mppUploaders[this.id]=this}init(){return!this._initialized&&!!this.settings.el&&(this.$el=r()(this.settings.el),!!this.$el.length&&(this.$container=this.$el.parents(".mpp-media-upload-container"),this.$wrapper=this.$el.parents(".mpp-new-media-container"),this.$feedback=this.$container.find(".mpp-feedback ul"),this._initialized=!0,this._createDropzone(),this._bindEvents(),void(this.settings.help&&this.updateHelpMessages(this.settings.help))))}updateHelpMessages(e){this.$container&&this.$container.length&&(e.browse&&this.$container.find(".dz-default .dz-button").html(e.browse),e.allowedFileType&&this.$container.find(".mpp-uploader-allowed-file-type-info").html(e.allowedFileType),e.allowedFileType&&this.$container.find(".mpp-uploader-allowed-max-file-size-info").html(e.fileSize),this.showHelpMessages())}showHelpMessages(){this.$container&&this.$container.length&&this.$container.find(".mpp-dropzone-upload-help").show()}hideHelpMessages(){this.$container&&this.$container.length&&this.$container.find(".mpp-dropzone-upload-help").hide()}_createDropzone(){this.settings.acceptedFiles=this.allowedFileTypes,this._dropzone=new(l())(this.$el.get(0),this.settings)}_bindEvents(){this.on("sending",this._appendParametersToRequest.bind(this)),this.on("success",this._onSuccess.bind(this)),this.on("error",this._onError.bind(this)),this.on("removedfile",this._onFileRemove.bind(this));let e=this._events||{};for(let t in e){let i=e[t];this.on(t,i)}}accept(e,t){}_onFileRemove(e){e.attachmentID?this.isResetting||this._deleteMedia(e.attachmentID):this.cleanFeedback(e)}_deleteMedia(e){if(!e)return!1;let t=this.settings.params.deleteMediaNonce?this.settings.params.deleteMediaNonce:this.settings.params._wpnonce;return r().post(ajaxurl,{action:"mpp_delete_media",media_id:e,cookie:encodeURIComponent(document.cookie),_wpnonce:t},(function(e){e.success,mpp.notify(e.message)}),"json"),!1}_onSuccess(e,t,i){n().isObject(t)||(t=JSON.parse(t)),t.success&&(e.attachmentID=t.data.id);let s=t.data;console.log(s.filename)}_onError(e,t,i){if(!n().isObject(t)||!e.previewElement)return;let s;e.previewElement.classList.add("dz-error"),s=t.data&&t.data.message?t.data.message:"There was an issue uploading";for(let t of e.previewElement.querySelectorAll("[data-dz-errormessage]"))t.textContent=s;this.$feedback.append(`<li id="mpp-upload-feedback-${e.upload.uuid}">${s}</li>`)}_appendParametersToRequest(e,t,i){for(let e in this.params)i.set(e,this.params[e])}cleanFeedback(e){this.$feedback.find(`#mpp-upload-feedback-${e.upload.uuid}`).remove()}on(e,t){if(!this._dropzone)return this;if(n().isObject(e))for(let t in e)this._dropzone.on(e,e[t]),this._eventRegistry.add(e,e[t]);else this._dropzone.on(e,t),this._eventRegistry.add(e,t);return this}off(e,t){return this._dropzone&&(this._dropzone.off(e,t),this._eventRegistry.remove(e,t)),this}getAttachedEvents(e){return this._eventRegistry.get(e)}getRegisteredEvents(){return this._eventRegistry.getAll()}getAttachedCallbacks(e){return this._eventRegistry.get(e)}getMediaType(){return this.mediaType}setMediaType(e){this.mediaType=e}getAllowedFileTypes(){return this.allowedFileTypes}setAllowedFileTypes(e){this.allowedFileTypes=n().isArray(e)?e.join(","):e}getParam(e){return this.params[e]||null}setParam(e,t){return this.params[e]=t,this}getParams(){return this.params}setParams(e){return this.params=e,this}getSettings(){return this.settings}updateSettings(e){this.settings=n().isObject(e)?e:this.settings}isEnabled(){return this._isEnabled}disable(){this._dropzone&&(this._dropzone.disable(),this._isEnabled=!1)}enable(){this._dropzone&&this._dropzone.enable()}reset(){this.isResetting=!0,this._dropzone&&this._dropzone.removeAllFiles(!0),this.$wrapper&&mpp&&mpp.mediaUtils&&mpp.mediaUtils.resetAttachedMedia(this.$wrapper),this.isResetting=!1}destroy(){this.isResetting=!0,this._dropzone&&this._dropzone.destroy(),this._initialized=!1,delete window._mppUploaders[this.id],this.isResetting=!1}debug(){for(let e in this)"$"===e[0]||"_dropzone"===e||n().isFunction(this[e])||console.log(e+"=>"+JSON.stringify(this[e]))}getUploadedFiles(){return this._dropzone?this._dropzone.getFilesWithStatus(l().SUCCESS):[]}getUploadedMediaIDs(){let e=[],t=this.getUploadedFiles();for(let i of t)i.attachmentID&&e.push(i.attachmentID);if(this.$wrapper&&mpp&&mpp.mediaUtils){let t=mpp.mediaUtils.getAttachedMedia(this.$wrapper);for(let i of t)i&&e.push(i)}return e}refresh(){this._dropzone&&(this.isResetting=!0,this._dropzone.removeAllFiles(!0),this.update({allowedFileTypes:this.allowedFileTypes}),this.isResetting=!1)}hideUI(){this.$wrapper&&this.$wrapper.slideUp("slow",(function(){r()(this).removeClass("mpp-new-media-container-active").addClass("mpp-new-media-container-inactive")}))}showUI(){this.$wrapper&&this.$wrapper.slideDown("slow",(function(){r()(this).removeClass("mpp-new-media-container-inactive").addClass("mpp-new-media-container-active")}))}isAttached(){return!!this.$el}openFileChooser(){if(this._dropzone&&this._dropzone.clickableElements.length){let e=r()(this._dropzone.clickableElements[this._dropzone.clickableElements.length-1]).first();e.length&&e.click()}}update(e){let t=this._dropzone;return!!t&&(e.allowedFileTypes&&(this.settings.allowedFileTypes=e.allowedFileTypes,t.options.acceptedFiles=e.allowedFileTypes,t.hiddenFileInput.setAttribute("accept",t.options.acceptedFiles)),e.dictInvalidFileType&&(t.options.dictInvalidFileType=e.dictInvalidFileType),!0)}}},934:function(e,t,i){i.d(t,{Z:function(){return s}});class s{constructor(){this._callbacks={}}add(e,t){return this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this}remove(e,t){if(!this._callbacks||0===arguments.length)return this._callbacks={},this;let i=this._callbacks[e];if(!i)return this;if(1===arguments.length)return delete this._callbacks[e],this;for(let e=0;e<i.length;e++)if(i[e]===t){i.splice(e,1);break}return this}get(e){return this._callbacks[e]||null}getAll(){return this._callbacks}}},487:function(e,t,i){i.r(t),i.d(t,{addAttachedMedia:function(){return p},getAttachedMedia:function(){return d},getExtensions:function(){return r},prepareExtensions:function(){return l},removeAttachedMedia:function(){return h},resetAttachedMedia:function(){return c},setupUploaderFileTypes:function(){return o}}),i(567);var s=i(711),n=i.n(s);window._mppUploadSettings=window._mppUploadSettings||{};const a=n().clone(_mppUploadSettings);function r(e){let t=e&&a.types&&a.types[e]?a.types[e]:{};return t&&t.extensions?t.extensions:""}function o(e,t){if(!a||!a.types)return;if(!t&&a.current_type&&(t=a.current_type),!t)return;e.type=t,e.setAllowedFileTypes(l(r(t)));let i=a.allowed_type_messages[t],s=a.type_browser_messages[t];e.updateHelpMessages({browse:s,fileSize:a.max_allowed_file_size,allowedFileType:i})}function l(e){if(!e||!e.length)return"";let t=e.split(","),i=[];for(let e of t)e=e.trim(),e.length&&("."!==e[0]&&(e="."+e),i.push(e));return i.join(",")}function d(e){let t=e.data("mpp-attached-media");return t&&n().isArray(t)||(t=[]),t}function p(e,t){let i=e.data("mpp-attached-media");i&&n().isArray(i)||(i=[]),i.push(t),e.data("mpp-attached-media",i)}function h(e,t){var i=e.data("mpp-attached-media");if(!i)return!1;i=n().without(i,""+t),e.data("mpp-attached-media",i)}function c(e){e.data("mpp-attached-media",[])}},623:function(e){e.exports=window.Dropzone},711:function(e){e.exports=window._},567:function(e){e.exports=window.jQuery}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,i),a.exports}i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e=i(965),t=i(487);let s=window.mpp||{};s.Uploader=e.Z,s.utils={},s.mediaUtils=t,window.mpp=s}()}();
//# sourceMappingURL=mpp-uploader.js.map